<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>支付订单</title>
  <link rel="stylesheet" type="text/css" href="../lib/css/weui.min.css" />
  <link rel="stylesheet" type="text/css" href="../custom/css/common.css" />
  <link rel="stylesheet" type="text/css" href="../custom/css/main.css" />

</head>

<body>
	<div class="container">
    <div class="order-pay-wrap">
        <div class="title-box">
            1145687254778<br />上海健康云陪诊服务中心
        </div>
        <p class="lineBg"></p>
        <div class="total-box">
            <h3>¥398.00</h3>
            <p>全程陪诊服务套餐<span>¥398.00/次</span></p>
        </div>
        <p class="lineBg"></p>
        <div class="pay-way">
          <h5>支付方式</h5>
          <ul class="pay-way-list">
            <li>
              <img src="../custom/images/apliy.png">
              <span>支付宝支付</span>
              <label class="custom_check_label">
                  <input type="radio" name="pay" id="radio1" value="1" hidden />
                  <label for="radio1" class="icon-check"></label>
              </label>
            </li>
            <li>
              <img src="../custom/images/wx.png">
              <span>微信支付</span>
              <label class="custom_check_label">
                  <input type="radio" name="pay" id="radio2" value="1" hidden />
                  <label for="radio2" class="icon-check"></label>
              </label>
            </li>
          </ul>
        </div>
    </div>
    <div class="custom-btm-fixed">
        <span class="custom-btm-btn">确认支付</span>
    </div>
  </div>
  <script type="text/javascript" src="../lib/js/flexible.js"></script>
  <script type="text/javascript" src="../lib/js/fastclick.min.js"></script>
  <script type="text/javascript" src="../lib/js/jquery.min.js"></script>
  <script type="text/javascript" src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
  <script src="../lib/js/jquery-weui.js"></script>
  <script src="../custom/js/native.js"></script>
  <script src="../custom/js/net.js"></script>

  <script>
    // $('.custom-btm-btn').click(function () {
    //   if($('#radio1').is(':checked')){
    //     // console.log(1);
    //     window.location.href = 'payResult.html';
    //   }
    //   if($('#radio2').is(':checked')){
    //     // console.log(2);
    //     window.location.href = 'payResult.html';
    //   }
    // })
    $('.pay-way-list li:eq(0)').click(function (e) {
      e.preventDefault();
      e.stopPropagation();
      $('#radio1').prop('checked', true);
    });
    $('.pay-way-list li:eq(1)').click(function (e) {
      e.preventDefault();
      e.stopPropagation();
      $('#radio2').prop('checked', true);
    });

    $(function () {
      var netToken = localStorage.getItem('netToken');
      var channelCode= localStorage.getItem('channelCode');
      var lightAppCode=localStorage.getItem('lightAppCode');
      var uid= localStorage.getItem('uid');
      //订单金额和订单id
      var order_code=getParams("order_code"),
          service_meal = getParams('service_meal'),
          biz_id = getParams('biz_id'),
          biz_name = getParams('biz_name'),
          pay_amount=getParams("pay_amount");
      // var pay_amount=decodeURIComponent(getParams("pay_amount"));
      console.log(order_code, '----------',pay_amount);
      $(".total-box span").html(pay_amount+'/次');
      // $(".total-box span").html("￥"+pay_amount);
      var newTab;
      //操作系统
      var ua = navigator.userAgent;
      var os;
      if (ua.toLowerCase().indexOf("iphone") > -1||ua.toLowerCase().indexOf("ipad") > -1) {
        os="ios";
      }else{
        os="android";
      }
      //支付宝
      // $("#alipay").on("click",function () {
      //   $("#alipay label")[0].addClass("checkRadio");
      //   $("#wechat label")[0].removeClass("checkRadio");
      // })
      // //微信支付
      // $("#wechat").on("click",function () {
      //   $("#wechat label")[0].addClass("checkRadio");
      //   $("#alipay label")[0].removeClass("checkRadio");
      // })
      //支付
      var checkedWay;
      $(".custom-btm-btn").on("click",function (){
        if($('#radio1').is(':checked')){
          console.log(1);
          checkedWay="alipay";
          // window.location.href = 'payResult.html';
        }
        if($('#radio2').is(':checked')){
          console.log(2);
          checkedWay="wechat";
          // window.location.href = 'payResult.html';
        }
        // if($("#alipay label").hasClass("checkRadio")){
        //   checkedWay="alipay"
        // }else if($("#wechat label").hasClass("checkRadio")){
        //   checkedWay="wechat"
        // }
        //请求统一支付
        newTab=window.open();
        try {
          $.ajax({
            url:net.scanConsume,
            type:"post",
            contentType: 'application/json',
            beforeSend: function(request) {
              request.setRequestHeader("token",netToken);
              request.setRequestHeader("channelCode",channelCode);
              request.setRequestHeader("lightAppCode",lightAppCode);
              request.setRequestHeader('appid', localStorage.getItem('appid'));
              request.setRequestHeader('timestamp', new Date().getTime());
              // request.setRequestHeader("uid",uid);
            },
            data:JSON.stringify({
              "amount":pay_amount,
              "payType":checkedWay,
              "merchantId":biz_id,//待定字段商户ID
              "businessNo":order_code,//待定字段业务单号
              "uid":uid,
              "clientIp":returnCitySN.cip,
              "os": os,
              "merchantName": service_meal,//待定字段
              "subject":service_meal,//待定字段
              "orderDesc":service_meal,//待定字段
              "orderItemDesc":service_meal//待定字段

            }),
            success:function(data){
              if(data.code===0){
                console.log(data);
                newTab.document.write(data.data);
              }else if(data.code===12){
                $.toast("账户在其他设备登录,请重新登录", 'forbidden');
                // $(".mytip").html("账户在其他设备登录,请重新登录");
                // showMyTip();
              }else{
                $.toast(data.msg||"跳转支付失败", 'forbidden');
                // $(".mytip").html(data.msg||"跳转支付失败");
                // showMyTip();
              }
            },
            error:function(error){
              console.log(error)
              // showMyTip();
            }
          })
        } catch (e) {
          // hideMyloading();
          // showMyTip();
          console.log(e);
        }

      })

    })
  </script>
</body>
</html>
